<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Warisan KL â€“ 3D Banner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    body { margin:0; padding:0; font-family: Arial, sans-serif; }
    .banner-container { width:100%; height:70vh; min-height:600px; position:relative; overflow:hidden; }
    #map { position:absolute; top:0; bottom:0; width:100%; height:100%; }
    .content-overlay {
      position:absolute; top:75%; left:50px;
      transform:translateY(-50%);
      color:white; z-index:10; pointer-events:none;
      text-shadow:0 2px 8px rgba(0,0,0,0.6);
    }
    .title { font-size:3rem; font-weight:bold; margin:0; }
    .subtitle { font-size:1.2rem; margin:0; opacity:0.9; }
    .attribution {
      position:absolute; right:8px; bottom:6px; z-index:30;
      color:#bbb; font-size:12px; background:rgba(0,0,0,0.25);
      padding:4px 6px; border-radius:4px;
    }
  </style>
</head>
<body>
  <div class="banner-container">
    <div id="map"></div>
    <div class="content-overlay">
      <div class="title">Urban Analytics</div>
      <div class="subtitle">From understanding data to developing insights</div>
    </div>
    <div class="attribution">Â© OpenStreetMap contributors â€¢ Style: Dark Matter (OpenMapTiles)</div>
  </div>

<script>
  const map = new maplibregl.Map({
    container: 'map',
    // ðŸ‘‡ Replace this with your OpenMapTiles / MapTiler Dark Matter style URL
    style: 'https://demotiles.maplibre.org/style.json', 
    center: [101.6956, 3.1479], // Masjid Jamek area
    zoom: 15,
    pitch: 60,
    bearing: -20
  });

  map.on('load', () => {
    // Replace default building layer with uniform grey extrusion
    map.addLayer({
      id: 'grey-buildings',
      source: 'openmaptiles',        // part of OpenMapTiles schema
      'source-layer': 'building',
      type: 'fill-extrusion',
      minzoom: 14,
      paint: {
        'fill-extrusion-color': '#888888',
        'fill-extrusion-height': [
          'interpolate', ['linear'], ['zoom'],
          14, 0,
          16, ['get', 'render_height']
        ],
        'fill-extrusion-base': ['get', 'render_min_height'],
        'fill-extrusion-opacity': 0.9
      }
    });

    // Popup for Masjid Jamek with live data from your proxy
    const masjidCoords = [101.6956, 3.1479];
    const popup = new maplibregl.Popup({ closeOnClick: false, offset: 10 })
      .setLngLat(masjidCoords)
      .setHTML("<b>Masjid Jamek Station</b><br>Loading live data...")
      .addTo(map);

    // Fetch live ridership from your proxy API
    fetch('/api/masjidjamek') 
      .then(res => res.json())
      .then(data => {
        popup.setHTML(`
          <b>Masjid Jamek Station</b><br>
          ${data.value.toLocaleString()} passengers/day<br>
          <small>As of ${data.date}</small>
        `);
      })
      .catch(err => {
        popup.setHTML("<b>Masjid Jamek Station</b><br>Data unavailable.");
      });
  });
</script>
</body>
</html>
